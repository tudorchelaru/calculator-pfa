---
// Logica de calcul pentru taxe PFA
// Sistemul actual din România: CASS, CAS, impozit pe venit

let venitBrut = 0;
let sistemImpozitare = 'real'; // 'real' sau 'norma'
let normaVenit = 0;

// Funcții de calcul
function calculCASS(venit: number): number {
	const pragCASS = 12 * 6000; // 72,000 RON/an în 2024
	if (venit <= pragCASS) {
		return venit * 0.10; // 10% până la prag
	}
	return pragCASS * 0.10; // 10% din prag după ce depășește
}

function calculCAS(venit: number): number {
	const pragCAS = 12 * 6000; // 72,000 RON/an
	if (venit <= pragCAS) {
		return venit * 0.25; // 25% până la prag
	}
	return pragCAS * 0.25; // 25% din prag după ce depășește
}

function calculImpozitReal(venit: number): number {
	const cass = calculCASS(venit);
	const cas = calculCAS(venit);
	const venitImpozabil = venit - cass - cas;
	return venitImpozabil * 0.10; // 10% impozit pe venit
}

function calculImpozitNorma(venit: number, norma: number): number {
	// Pentru sistemul pe normă de venit, calculul este diferit
	// Simplificat: impozit fix sau procent din norma de venit
	return norma * 0.10; // Exemplu simplificat
}
---

<div class="calculator">
	<div class="input-section">
		<label for="venit">
			<span>Venit Brut Lunar (RON)</span>
			<input 
				type="number" 
				id="venit" 
				name="venit"
				value="0"
				min="0"
				step="100"
			/>
		</label>

		<label for="sistem">
			<span>Sistem de Impozitare</span>
			<select id="sistem" name="sistem">
				<option value="real">Real (CASS + CAS + Impozit)</option>
				<option value="norma">Normă de Venit</option>
			</select>
		</label>

		<label for="norma" id="norma-label" style="display: none;">
			<span>Normă de Venit (RON)</span>
			<input 
				type="number" 
				id="norma" 
				name="norma"
				value="0"
				min="0"
				step="100"
			/>
		</label>
	</div>

	<div class="results-section">
		<div class="result-card">
			<span class="label">Venit Brut Anual</span>
			<span class="value" id="venit-anual">0 RON</span>
		</div>
		<div class="result-card">
			<span class="label">CASS</span>
			<span class="value" id="cass">0 RON</span>
		</div>
		<div class="result-card">
			<span class="label">CAS</span>
			<span class="value" id="cas">0 RON</span>
		</div>
		<div class="result-card">
			<span class="label">Impozit pe Venit</span>
			<span class="value" id="impozit">0 RON</span>
		</div>
		<div class="result-card total">
			<span class="label">Total Taxe</span>
			<span class="value" id="total-taxe">0 RON</span>
		</div>
		<div class="result-card net">
			<span class="label">Venit Net Anual</span>
			<span class="value" id="venit-net">0 RON</span>
		</div>
	</div>
</div>

<script>
	const venitInput = document.getElementById('venit') as HTMLInputElement;
	const sistemSelect = document.getElementById('sistem') as HTMLSelectElement;
	const normaInput = document.getElementById('norma') as HTMLInputElement;
	const normaLabel = document.getElementById('norma-label') as HTMLLabelElement;

	function calculCASS(venit: number): number {
		const pragCASS = 12 * 6000; // 72,000 RON/an
		if (venit <= pragCASS) {
			return venit * 0.10;
		}
		return pragCASS * 0.10;
	}

	function calculCAS(venit: number): number {
		const pragCAS = 12 * 6000; // 72,000 RON/an
		if (venit <= pragCAS) {
			return venit * 0.25;
		}
		return pragCAS * 0.25;
	}

	function calculImpozitReal(venit: number): number {
		const cass = calculCASS(venit);
		const cas = calculCAS(venit);
		const venitImpozabil = venit - cass - cas;
		return venitImpozabil * 0.10;
	}

	function calculImpozitNorma(venit: number, norma: number): number {
		// Pentru sistemul pe normă, calculul este simplificat
		return norma * 0.10;
	}

	function updateCalculations() {
		const venitLunar = parseFloat(venitInput.value) || 0;
		const venitAnual = venitLunar * 12;
		const sistem = sistemSelect.value;

		let cass = 0;
		let cas = 0;
		let impozit = 0;

		if (sistem === 'real') {
			cass = calculCASS(venitAnual);
			cas = calculCAS(venitAnual);
			impozit = calculImpozitReal(venitAnual);
		} else {
			const norma = parseFloat(normaInput.value) || 0;
			impozit = calculImpozitNorma(venitAnual, norma);
		}

		const totalTaxe = cass + cas + impozit;
		const venitNet = venitAnual - totalTaxe;

		// Update UI
		(document.getElementById('venit-anual') as HTMLElement).textContent = formatCurrency(venitAnual);
		(document.getElementById('cass') as HTMLElement).textContent = formatCurrency(cass);
		(document.getElementById('cas') as HTMLElement).textContent = formatCurrency(cas);
		(document.getElementById('impozit') as HTMLElement).textContent = formatCurrency(impozit);
		(document.getElementById('total-taxe') as HTMLElement).textContent = formatCurrency(totalTaxe);
		(document.getElementById('venit-net') as HTMLElement).textContent = formatCurrency(venitNet);
	}

	function formatCurrency(value: number): string {
		return new Intl.NumberFormat('ro-RO', {
			style: 'currency',
			currency: 'RON',
			minimumFractionDigits: 2,
			maximumFractionDigits: 2
		}).format(value);
	}

	venitInput.addEventListener('input', updateCalculations);
	sistemSelect.addEventListener('change', () => {
		if (sistemSelect.value === 'norma') {
			normaLabel.style.display = 'block';
		} else {
			normaLabel.style.display = 'none';
		}
		updateCalculations();
	});
	normaInput.addEventListener('input', updateCalculations);

	// Initial calculation
	updateCalculations();
</script>

<style>
	.calculator {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.input-section {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	label {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	label span {
		font-weight: 600;
		color: #333;
		font-size: 0.95rem;
	}

	input[type="number"],
	select {
		padding: 0.75rem 1rem;
		border: 2px solid #e0e0e0;
		border-radius: 8px;
		font-size: 1rem;
		transition: border-color 0.2s;
	}

	input[type="number"]:focus,
	select:focus {
		outline: none;
		border-color: #667eea;
	}

	.results-section {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
		gap: 1rem;
		margin-top: 1rem;
	}

	.result-card {
		background: #f8f9fa;
		padding: 1.5rem;
		border-radius: 12px;
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		border: 2px solid transparent;
		transition: all 0.2s;
	}

	.result-card:hover {
		border-color: #667eea;
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
	}

	.result-card.total {
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
		grid-column: 1 / -1;
	}

	.result-card.net {
		background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
		color: white;
		grid-column: 1 / -1;
	}

	.result-card .label {
		font-size: 0.9rem;
		opacity: 0.8;
		font-weight: 500;
	}

	.result-card .value {
		font-size: 1.5rem;
		font-weight: 700;
	}

	.result-card.total .value,
	.result-card.net .value {
		font-size: 2rem;
	}

	@media (max-width: 768px) {
		.results-section {
			grid-template-columns: 1fr;
		}

		.result-card.total,
		.result-card.net {
			grid-column: 1;
		}
	}
</style>
